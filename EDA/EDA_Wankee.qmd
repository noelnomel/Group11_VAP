---
title: "EDA_Wankee"
author: "Wan Kee"
date: "17 February 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  freeze: true
  warning: false
  message: false
  error: true
---

# 1. Import Packages

```{r}
pacman::p_load(tidyverse, readr, psych, st, stars, tmap, neaSG)
```

```{r}
weather_list <- list.files(path = "data",
                           recursive = TRUE,
                           pattern = "\\.csv$",
                           full.names = TRUE)
list(weather_list)
```

```{r}
weather <- read_csv(weather_list)
glimpse(weather)
```
```{r}
describe(weather)
```
::: {.callout-note collapse="true"}
## Save rds

```{r}
write_rds(weather, "data/weather.rds")
```
:::


::: {.callout-note collapse="true"}
## Load rds

```{r}
weather <- readRDS("data/weather.rds")
```
:::

```{r}
mpsz <- st_read(dsn = "data/geospatial", layer = "MPSZ-2019") %>% 
  st_transform(crs=3414)
```
```{r}
glimpse(mpsz)
```


```{r}
tmap_mode("view")

tm_shape(mpsz) +
  tm_polygons(col = "REGION_N", palette = "Set2")+
  tm_layout(main.title = "Planning Area",
            main.title.position = "left",
            main.title.size = 1,
            legend.show = FALSE,
            frame = FALSE) +
  tmap_options(check.and.fix = TRUE) +
  tm_view(set.zoom.limits = c(11,12))
```


```{r}
tmap_mode("view")

tm_shape(mpsz) +
  tm_polygons(col = "PLN_AREA_C", palette = "Set2")+
  tm_layout(main.title = "Planning Area",
            main.title.position = "left",
            main.title.size = 1,
            legend.show = FALSE,
            frame = FALSE) +
  tm_view(set.zoom.limits = c(11,12))
```
```{r}
unique(mpsz$PLN_AREA_N)
```

```{r}
unique(weather$Station)
```
```{r}
station_to_subzone <- c(
  "Admiralty" = "WOODLANDS",
  "Ang Mo Kio" = "ANG MO KIO",
  "Boon Lay (East)" = "BOON LAY",
  "Changi" = "CHANGI",
  "Choa Chu Kang (South)" = "CHOA CHU KANG",
  "Clementi" = "CLEMENTI",
  "East Coast Parkway" = "BEDOK",
  "Jurong (West)" = "JURONG WEST",
  "Khatib" = "YISHUN",
  "Marina Barrage" = "MARINA SOUTH",
  "Newton" = "NEWTON",
  "Pasir Panjang" = "PASIR PANJANG",
  "Paya Lebar" = "PAYA LEBAR",
  "Seletar" = "SELETAR",
  "Sembawang" = "SEMBAWANG",
  "Tai Seng" = "HOUGANG",
  "Tengah" = "TENGAH",
  "Tuas South" = "TUAS"
)

weather$Subzone <- station_to_subzone[weather$Station]
weather <- weather[, c("Subzone", setdiff(names(weather), "Subzone"))]
head(weather)
```

```{r}
stn <- get_weatherstns()
glimpse(stn)
```
```{r}
unique(stn$name)
```

# ggbetweenstats: year, temp_diff, stat, type, mean.ci, pairwise comparison; allow the various parameter to be available on shiny app.